<!-- Modal de Adicionar Post -->
<style>
    /* Modal sizing */
    #addPostModal {
        z-index: 9999 !important;
    }

    #addPostModal .modal-content {
        width: 90% !important;
        max-width: 1200px !important;
        margin: 2rem auto !important;
    }

    #addPostModal .modal-body {
        padding: 2rem !important;
    }

    /* Form Steps Container */
    #addPostModal .form-steps {
        display: flex !important;
        justify-content: space-between !important;
        align-items: center !important;
        margin: 0 auto 3rem auto !important;
        padding: 0 !important;
        max-width: 600px !important;
        position: relative !important;
    }

    /* Linha de fundo conectando os steps */
    #addPostModal .form-steps::before {
        content: '' !important;
        position: absolute !important;
        top: 20px !important;
        left: 20px !important;
        right: 20px !important;
        height: 3px !important;
        background: #e9ecef !important;
        z-index: 1 !important;
    }

    /* Cada step individual */
    #addPostModal .form-steps .step {
        display: flex !important;
        flex-direction: column !important;
        align-items: center !important;
        position: relative !important;
        z-index: 2 !important;
        cursor: pointer !important;
        flex: 0 0 auto !important;
        transition: all 0.3s ease !important;
    }

    /* Número do step */
    #addPostModal .form-steps .step-number {
        width: 40px !important;
        height: 40px !important;
        border-radius: 50% !important;
        background: #e9ecef !important;
        color: #6c757d !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        font-weight: 600 !important;
        font-size: 1rem !important;
        border: 3px solid #fff !important;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
        transition: all 0.3s ease !important;
        position: relative !important;
        z-index: 3 !important;
    }

    /* Step ativo */
    #addPostModal .form-steps .step.active .step-number {
        background: var(--admin-primary, #3a86ff) !important;
        color: white !important;
        box-shadow: 0 4px 12px rgba(58, 134, 255, 0.4) !important;
        transform: scale(1.1) !important;
    }

    /* Step completado */
    #addPostModal .form-steps .step.completed .step-number {
        background: #28a745 !important;
        color: white !important;
    }

    /* Hover effect */
    #addPostModal .form-steps .step:hover .step-number {
        transform: scale(1.15) !important;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2) !important;
    }

    /* Título do step */
    #addPostModal .form-steps .step-title {
        margin-top: 0.75rem !important;
        font-size: 0.85rem !important;
        color: #6c757d !important;
        text-align: center !important;
        font-weight: 500 !important;
        white-space: nowrap !important;
        transition: all 0.3s ease !important;
    }

    #addPostModal .form-steps .step.active .step-title {
        color: var(--admin-primary, #3a86ff) !important;
        font-weight: 600 !important;
    }

    #addPostModal .form-steps .step.completed .step-title {
        color: #28a745 !important;
    }

    #addPostModal .form-steps .step:hover .step-title {
        color: var(--admin-primary, #3a86ff) !important;
    }

    /* Step Content */
    #addPostModal .step-content {
        display: none !important;
    }

    #addPostModal .step-content.active {
        display: block !important;
        animation: fadeIn 0.3s ease !important;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* CRÍTICO: Forçar layout de 2 colunas funcionar - MÁXIMA ESPECIFICIDADE */
    #addPostModal .step-content .row {
        display: flex !important;
        flex-wrap: wrap !important;
        margin-left: -15px !important;
        margin-right: -15px !important;
    }

    /* Mobile primeiro - 100% de largura */
    #addPostModal .step-content div.col-md-4,
    #addPostModal .step-content div.col-md-6,
    #addPostModal .step-content div.col-md-8 {
        position: relative !important;
        width: 100% !important;
        padding-left: 15px !important;
        padding-right: 15px !important;
        flex: 0 0 100% !important;
        max-width: 100% !important;
    }

    /* DESKTOP: Forçar 2 colunas em telas >= 768px com MÁXIMA PRIORIDADE */
    @media screen and (min-width: 768px) {
        #addPostModal .step-content div.col-md-4 {
            flex: 0 0 33.333333% !important;
            max-width: 33.333333% !important;
            width: 33.333333% !important;
        }

        #addPostModal .step-content div.col-md-6 {
            flex: 0 0 50% !important;
            max-width: 50% !important;
            width: 50% !important;
        }

        #addPostModal .step-content div.col-md-8 {
            flex: 0 0 66.666667% !important;
            max-width: 66.666667% !important;
            width: 66.666667% !important;
        }
    }
</style>
<div class="modal" id="addPostModal">
    <div class="modal-content modal-xl">
        <div class="modal-header">
            <div class="modal-title-container">
                <h3><i class="fas fa-plus-circle"></i> Criar Novo Post</h3>
                <p class="modal-subtitle">Adicione conteúdo para compartilhar com a comunidade</p>
            </div>
            <button class="close-modal" data-bs-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
            <!-- Progress Steps -->
            <div class="form-steps">
                <div class="step active" data-step="1">
                    <span class="step-number">1</span>
                    <span class="step-title">Informações Básicas</span>
                </div>
                <div class="step" data-step="2">
                    <span class="step-number">2</span>
                    <span class="step-title">Detalhes</span>
                </div>
                <div class="step" data-step="3">
                    <span class="step-number">3</span>
                    <span class="step-title">SEO & Publicação</span>
                </div>
            </div>

            <form id="addPostForm" action="{{ url_for('admin_create_post') }}" method="POST" enctype="multipart/form-data">
                <!-- Step 1: Informações Básicas -->
                <div class="step-content active" data-step="1">
                    <div class="row" style="display: flex !important; flex-wrap: wrap !important;">
                        <div class="col-md-8" style="flex: 0 0 66.666667%; max-width: 66.666667%; padding: 0 15px;">
                            <div class="form-group">
                                <label for="postTitle" class="form-label">
                                    <i class="fas fa-heading"></i> Título do Post
                                    <span class="required">*</span>
                                </label>
                                <input type="text" id="postTitle" name="title"
                                       class="form-control modern-input{% if form_errors and form_errors.title %} is-invalid{% endif %}"
                                       value="{{ form_data.title if form_data else '' }}"
                                       placeholder="Digite um título atrativo para o seu post..."
                                       required>
                                <div class="character-count">
                                    <span id="titleCount">0</span>/100 caracteres
                                </div>
                                {% if form_errors and form_errors.title %}
                                    <div class="invalid-feedback">{{ form_errors.title }}</div>
                                {% endif %}
                            </div>

                            <div class="form-group">
                                <label for="postContent" class="form-label">
                                    <i class="fas fa-align-left"></i> Descrição Completa
                                    <span class="required">*</span>
                                </label>
                                <div class="editor-toolbar">
                                    <button type="button" class="toolbar-btn" data-command="bold" title="Negrito">
                                        <i class="fas fa-bold"></i>
                                    </button>
                                    <button type="button" class="toolbar-btn" data-command="italic" title="Itálico">
                                        <i class="fas fa-italic"></i>
                                    </button>
                                    <button type="button" class="toolbar-btn" data-command="underline" title="Sublinhado">
                                        <i class="fas fa-underline"></i>
                                    </button>
                                    <div class="toolbar-separator"></div>
                                    <button type="button" class="toolbar-btn" data-command="insertUnorderedList" title="Lista">
                                        <i class="fas fa-list-ul"></i>
                                    </button>
                                    <button type="button" class="toolbar-btn" data-command="insertOrderedList" title="Lista Numerada">
                                        <i class="fas fa-list-ol"></i>
                                    </button>
                                    <div class="toolbar-separator"></div>
                                    <button type="button" class="toolbar-btn" data-command="createLink" title="Link">
                                        <i class="fas fa-link"></i>
                                    </button>
                                </div>
                                <div class="editor-container">
                                    <div id="postContentEditor" class="rich-editor" contenteditable="true"
                                         placeholder="Descreva detalhadamente o conteúdo do post..."></div>
                                    <textarea id="postContent" name="content" style="display: none;" required>{{ form_data.content if form_data else '' }}</textarea>
                                </div>
                                <div class="character-count">
                                    <span id="contentCount">0</span> caracteres
                                </div>
                                {% if form_errors and form_errors.content %}
                                    <div class="invalid-feedback">{{ form_errors.content }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="col-md-4" style="flex: 0 0 33.333333%; max-width: 33.333333%; padding: 0 15px;">
                            <div class="sidebar-card">
                                <h5><i class="fas fa-image"></i> Imagem de Destaque</h5>
                                <div class="image-upload-area" id="imageUploadArea">
                                    <div class="upload-placeholder">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                        <p>Clique ou arraste uma imagem</p>
                                        <span class="file-types">JPG, PNG até 5MB</span>
                                    </div>
                                    <input type="file" id="postImage" name="image_file" accept="image/*" style="display: none;" aria-label="Selecionar imagem do post">
                                    <div class="image-preview" style="display: none;">
                                        <img id="previewImg" src="" alt="Preview">
                                        <button type="button" class="remove-image" id="removeImage" aria-label="Remover imagem">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="postCategory" class="form-label">
                                    <i class="fas fa-folder"></i> Categoria
                                    <span class="required">*</span>
                                </label>
                                <select id="postCategory" name="category"
                                        class="form-select modern-select{% if form_errors and form_errors.category %} is-invalid{% endif %}"
                                        required>
                                    <option value="">Selecione uma categoria</option>
                                    {% for category in categories %}
                                    <option value="{{ category.id }}"
                                            {% if form_data and form_data.category == category.id|string %}selected{% endif %}>
                                        {{ category.name }}
                                    </option>
                                    {% endfor %}
                                </select>
                                {% if form_errors and form_errors.category %}
                                    <div class="invalid-feedback">{{ form_errors.category }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Detalhes -->
                <div class="step-content" data-step="2">
                    <div class="row" style="display: flex !important; flex-wrap: wrap !important;">
                        <div class="col-md-6" style="flex: 0 0 50%; max-width: 50%; padding: 0 15px;">
                            <div class="form-group">
                                <label for="postDownloadLink" class="form-label">
                                    <i class="fas fa-download"></i> Link de Download
                                    <span class="required">*</span>
                                </label>
                                <div class="input-group">
                                    <input type="url" id="postDownloadLink" name="download_link"
                                           class="form-control modern-input{% if form_errors and form_errors.download_link %} is-invalid{% endif %}"
                                           value="{{ form_data.download_link if form_data else '' }}"
                                           placeholder="https://exemplo.com/arquivo.zip"
                                           required>
                                    <button type="button" class="btn-group-item" id="validateLink" title="Validar Link">
                                        <i class="fas fa-check"></i>
                                    </button>
                                </div>
                                <div class="link-status" id="linkStatus"></div>
                                {% if form_errors and form_errors.download_link %}
                                    <div class="invalid-feedback">{{ form_errors.download_link }}</div>
                                {% endif %}
                            </div>

                            <div class="form-group">
                                <label for="postFileSize" class="form-label">
                                    <i class="fas fa-file-archive"></i> Tamanho do Arquivo
                                </label>
                                <div class="input-group">
                                    <input type="number" id="postFileSize" name="file_size"
                                           class="form-control modern-input"
                                           placeholder="0" step="0.1" min="0">
                                    <select class="form-select unit-select" id="fileSizeUnit" aria-label="Unidade de medida do tamanho do arquivo">
                                        <option value="MB">MB</option>
                                        <option value="GB">GB</option>
                                        <option value="KB">KB</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="postVersion" class="form-label">
                                    <i class="fas fa-code-branch"></i> Versão
                                </label>
                                <input type="text" id="postVersion" name="version"
                                       class="form-control modern-input"
                                       placeholder="Ex: 2.1.0, v1.5, 2023.1">
                            </div>
                        </div>

                        <div class="col-md-6" style="flex: 0 0 50%; max-width: 50%; padding: 0 15px;">
                            <div class="form-group">
                                <label for="postTags" class="form-label">
                                    <i class="fas fa-tags"></i> Tags
                                </label>
                                <div class="tags-input-container">
                                    <div class="tags-display" id="tagsDisplay"></div>
                                    <input type="text" id="postTagsInput"
                                           class="form-control modern-input tags-input"
                                           placeholder="Digite uma tag e pressione Enter">
                                    <input type="hidden" id="postTags" name="tags" value="{{ form_data.tags if form_data else '' }}">
                                </div>
                                <div class="form-text">Pressione Enter para adicionar cada tag</div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-cog"></i> Configurações
                                </label>
                                <div class="checkbox-group modern-checkboxes">
                                    <div class="form-check">
                                        <input type="checkbox" id="postFeatured" name="featured"
                                               class="form-check-input" {% if form_data and form_data.featured %}checked{% endif %}>
                                        <label for="postFeatured" class="form-check-label">
                                            <i class="fas fa-star"></i> Post em Destaque
                                        </label>
                                        <small>Aparece na página principal</small>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" id="postNotifyUsers" name="notify_users" class="form-check-input">
                                        <label for="postNotifyUsers" class="form-check-label">
                                            <i class="fas fa-bell"></i> Notificar Usuários
                                        </label>
                                        <small>Enviar notificação por email</small>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" id="postComments" name="allow_comments" class="form-check-input" checked>
                                        <label for="postComments" class="form-check-label">
                                            <i class="fas fa-comments"></i> Permitir Comentários
                                        </label>
                                        <small>Usuários podem comentar</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: SEO & Publicação -->
                <div class="step-content" data-step="3">
                    <div class="row" style="display: flex !important; flex-wrap: wrap !important;">
                        <div class="col-md-4" style="flex: 0 0 33.333333%; max-width: 33.333333%; padding: 0 15px;">
                            <h5><i class="fas fa-search"></i> Otimização para Mecanismos de Busca</h5>

                            <div class="form-group">
                                <label for="postSeoTitle" class="form-label">
                                    <i class="fas fa-heading"></i> Título SEO
                                </label>
                                <input type="text" id="postSeoTitle" name="seo_title"
                                       class="form-control modern-input"
                                       placeholder="Título otimizado para SEO (deixe vazio para usar o título do post)">
                                <div class="character-count">
                                    <span id="seoTitleCount">0</span>/60 caracteres recomendados
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="postSeoDescription" class="form-label">
                                    <i class="fas fa-align-left"></i> Descrição SEO
                                </label>
                                <textarea id="postSeoDescription" name="seo_description"
                                          class="form-control modern-input" rows="3"
                                          placeholder="Descrição que aparecerá nos resultados de busca"></textarea>
                                <div class="character-count">
                                    <span id="seoDescCount">0</span>/160 caracteres recomendados
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="postSlug" class="form-label">
                                    <i class="fas fa-link"></i> URL Personalizada (Slug)
                                </label>
                                <div class="input-group">
                                    <span class="input-group-text">mundodainformatica.com/post/</span>
                                    <input type="text" id="postSlug" name="slug"
                                           class="form-control modern-input"
                                           placeholder="url-amigavel-do-post">
                                </div>
                                <div class="form-text">Deixe vazio para gerar automaticamente</div>
                            </div>
                        </div>

                        <div class="col-md-4" style="flex: 0 0 33.333333%; max-width: 33.333333%; padding: 0 15px;">
                            <div class="sidebar-card">
                                <h5><i class="fas fa-calendar"></i> Publicação</h5>

                                <div class="form-group">
                                    <label class="form-label">Status</label>
                                    <div class="radio-group modern-radios">
                                        <div class="form-check">
                                            <input type="radio" id="statusDraft" name="status" value="draft" class="form-check-input">
                                            <label for="statusDraft" class="form-check-label">
                                                <i class="fas fa-edit"></i> Rascunho
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input type="radio" id="statusPublished" name="status" value="published" class="form-check-input" checked>
                                            <label for="statusPublished" class="form-check-label">
                                                <i class="fas fa-globe"></i> Publicar Agora
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input type="radio" id="statusScheduled" name="status" value="scheduled" class="form-check-input">
                                            <label for="statusScheduled" class="form-check-label">
                                                <i class="fas fa-clock"></i> Agendar
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group" id="scheduleGroup" style="display: none;">
                                    <label for="publishDate" class="form-label">Data de Publicação</label>
                                    <input type="datetime-local" id="publishDate" name="publish_date"
                                           class="form-control modern-input">
                                </div>
                            </div>

                            <div class="sidebar-card mt-3">
                                <h5><i class="fas fa-eye"></i> Preview</h5>
                                <div class="post-preview">
                                    <div class="preview-title" id="previewTitle">Título do Post</div>
                                    <div class="preview-meta">
                                        <span id="previewCategory">Categoria</span> •
                                        <span id="previewDate">Hoje</span>
                                    </div>
                                    <div class="preview-description" id="previewDescription">
                                        Descrição aparecerá aqui...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <div class="footer-left">
                <button type="button" class="btn-admin btn-admin-outline" id="prevStep" style="display: none;">
                    <i class="fas fa-arrow-left"></i> Anterior
                </button>
            </div>
            <div class="footer-right">
                <button type="button" class="btn-admin btn-admin-outline" data-bs-dismiss="modal">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button type="button" class="btn-admin btn-admin-secondary" id="nextStep">
                    Próximo <i class="fas fa-arrow-right"></i>
                </button>
                <button type="button" class="btn-admin btn-admin-primary" id="savePostBtn" style="display: none;">
                    <i class="fas fa-save"></i> Salvar Post
                </button>
            </div>
        </div>
    </div>
</div>
